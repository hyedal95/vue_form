<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마켓컬리 회원가입폼</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./script/lib/vue.js"></script>
    <script src="./script/lib/postcode.v2.js"></script>
    <script src="./script/lib/axios.min.js"></script>

</head>
<body>

<!-- 템플릿트 -->
<div id="wrap">
    <header id="header"></header>
    <main id="main">
        <section id="section1">
            <div class="container">
                <div class="title">
                    <h2>회원가입</h2>
                    <p><span><i>*</i>필수입력사항</span></p>
                </div>
                <div class="content" id="signUp">
                    <form>
                        <div class="signup-box">
                            <ul>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label for="userId">아이디<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <input type="text" id="userId" name="userId" maxlength="16" v-model="아이디" placeholder="아이디를 입력해주세요">
                                        </div>
                                        <div class="right">
                                            <button>중복확인</button>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label for="userPw1">비밀번호<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <input type="password" id="userPw1" name="userPw1" maxlength="16" v-model="비밀번호"  placeholder="비밀번호를 입력해주세요" autocomplete="off">
                                        </div>
                                        <div class="right">
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label for="userPw2">비밀번호확인<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <input type="password" id="userPw2" name="userPw2" maxlength="16"  v-model="비밀번호확인"  placeholder="비밀번호를 한번 더 입력해주세요" autocomplete="off">
                                        </div>
                                        <div class="right">
 
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label for="userName">이름<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <input type="text" id="userName" name="userName"  v-model="이름" placeholder="이름을 입력해주세요">
                                        </div>
                                        <div class="right">

                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label for="userEmail">이메일<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <input type="text" id="userEmail" name="userEmail"  v-model="이메일"  placeholder="예:moonseonjong@naver.com">
                                        </div>
                                        <div class="right">
                                            <button>중복확인</button>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label for="userHp">휴대폰<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <input type="text" id="userHp" name="userHp"  v-model="휴대폰" placeholder="숫자만 입력해주세요">
                                        </div>
                                        <div class="right">
                                            <button class="off">비밀번호받기</button>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label>주소<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <input type="text" id="userAddress1" name="userAddress1"  v-model="주소1" placeholder="주소를 검색해주세요." >
                                            <input type="text" id="userAddress2" name="userAddress2"  v-model="주소2" placeholder="나머지 주소를 입력해주세요.">
                                            <input type="button" id="userAddrBtn" name="userAddrBtn" @click.prevent="addrSearchMethod()" value="    주소검색" target="view">
                                            <p class="addre-guide-text">배송지에 따라 상품 정보가 달라질 수 있습니다.</p>
                                        </div>
                                        <div class="right">
                                            
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label>성별</label>
                                        </div>
                                        <div class="center">
                                            <div class="radio-box">
                                                <label><input v-model="성별" type="radio" id="male"   name="gender" value="남자"><span>남자</span></label>
                                                <label><input v-model="성별" type="radio" id="female" name="gender" value="여자"><span>여자</span></label>
                                                <label><input v-model="성별" type="radio" id="none"   name="gender" value="선택안함"><span>선택안함</span></label>
                                            </div>
                                        </div>
                                        <div class="right">
                                            
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label for="year">생년월일</label>
                                        </div>
                                        <div class="center">
                                            <div class="birth-box">
                                                <input v-model="생년" maxlength="4" type="text" id="year"   name="birth" placeholder="YYYY">
                                                <i>/</i>
                                                <input v-model="생월" maxlength="2" type="text" id="month" name="birth" placeholder="MM">
                                                <i>/</i>
                                                <input v-model="생일" maxlength="2" type="text" id="date"   name="birth" placeholder="DD">
                                            </div>
                                        </div>
                                        <div class="right">
                                            
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="row-box">
                                        <div class="left">
                                            <label>추가입력 사항</label>
                                        </div>
                                        <div class="center">
                                            <div class="radio-box">
                                                <label><input v-model="추가입력사항" type="radio" id="chooga1" name="chooga" value="친구초대 추천인 아이디"><span>친구초대 추천인 아이디</span></label>
                                                <label><input v-model="추가입력사항" type="radio" id="chooga2" name="chooga" value="참여 이벤트명"><span>참여 이벤트명</span></label>
                                            </div>
                                        </div>
                                        <div class="right">
                                            
                                        </div>
                                    </div>
                                </li>


                                <!-- 가로줄 -->
                                <li class="hr">
                                    <hr>
                                </li>
                                <!-- 이용약관동의 -->
                                <li>
                                    <div class="row-box service">
                                        <div class="left">
                                            <label>이용약관동의<i>*</i></label>
                                        </div>
                                        <div class="center">
                                            <div class="check-box">
                                                <label><input @input="inputCheckAll" type="checkbox" id="chkAll" name="chk" value="전체 동의합니다." :checked="이용약관동의.length===7?true:false" ><span>전체 동의합니다.</span></label>
                                            </div>
                                            <p>선택항목에 동의하지 않은 경우도 회원가입 및 일반적인 서비스를 이용할 수 있습니다.</p>
                                        </div>
                                        <div class="center">
                                            <div class="check-box">
                                                <label><input v-model="이용약관동의" type="checkbox" id="chk1" name="chk" value="이용약관 동의(필수)"><span>이용약관 동의</span></label><em>(필수)</em>
                                            </div>
                                        </div>
                                        <div class="center">
                                            <div class="check-box">
                                                <label><input v-model="이용약관동의" type="checkbox" id="chk2" name="chk" value="개인정보 수집∙이용 동의(필수)"><span>개인정보 수집∙이용 동의</span></label><em>(필수)</em>
                                            </div>
                                        </div>
                                        <div class="center">
                                            <div class="check-box">
                                                <label><input v-model="이용약관동의" type="checkbox" id="chk3" name="chk" value="개인정보 수집∙이용 동의(선택)"><span>개인정보 수집∙이용 동의</span></label><em>(선택)</em>
                                            </div>
                                        </div>
                                        <div class="center">
                                            <div class="check-box">
                                                <label><input v-model="이용약관동의" type="checkbox" id="chk4" name="chk" value="무료배송, 할인쿠폰 등 혜택/정보 수신 동의(선택)"><span>무료배송, 할인쿠폰 등 혜택/정보 수신 동의</span></label><em>(선택)</em>
                                            </div>
                                        </div>
                                        <div class="center">
                                            <div class="check-box sns-email-check">
                                                <label><input v-model="이용약관동의" type="checkbox" id="chk5" name="chk" value="SNS"><span>SNS</span></label>
                                                <label><input v-model="이용약관동의" type="checkbox" id="chk6" name="chk" value="이메일"><span>이메일</span></label>
                                            </div>
                                            <p>동의 시 한 달간 [5%적립] + [2만원 이상 무료배송] 첫 주문 후 안내</p>
                                        </div>
                                        
                                        <div class="center">
                                            <div class="check-box">
                                                <label><input v-model="이용약관동의" type="checkbox" id="chk7" name="chk" value="본인은 만 14세 이상입니다.(필수)"><span>본인은 만 14세 이상입니다.</span></label><em>(필수)</em>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </li>


                            </ul>
                            <div class="submit-box">
                                <button @click.prevent="submitMethod" type="submit">가입하기</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>
    <footer id="footer"></footer>

    <div class="modal" v-show="isModalShow">
        <div class="wrap"> <!-- 모달창을 가운데 정렬을 위해 두는게 wrap -->
            <div class="container"> <!-- 모달창의 실제 너비  포지션 래러티브가 되고 타이틀 컨텐츠 인덱스1 주소검색박스 인덱스2--> 
                <div class="window-title">
                    <h1>
                        <img src="./images/favicon-192x192.jpg" alt="아이콘">
                        <strong>컬리 - 마켓컬리/뷰티컬리- chrome</strong>
                    </h1>
                    <button @click.prevent="onClickModalClose">×</button>
                </div>
                <div class="content">
                    <div class="title">
                        <h2><strong>샛별배송</strong><span> 지역입니다.</span></h2>
                        <h3>매일 새벽, 문 앞까지 신선함을 전해드려요.</h3>
                    </div>
                    <div class="contents">
                        <ul>
                            <li>
                                <input type="text" v-model="주소1" id="addr1" name="addr1" >
                                <input type="button"  id="reSearch" name="reSearch"  value="     재검색">
                            </li>
                            <li>
                                <input type="text" v-model="주소2" id="addr2" name="addr2"  placeholder="나머지 주소를 입력해주세요.">
                            </li>
                            <li>
                                <p>※ 저장된 배송지는 최대 7일 간 임시 저장 후 자동 삭제됩니다.</p>
                                <p>로그인 할 경우, 회원님의 배송지 목록에 추가됩니다.</p>
                            </li>
                            <li>
                                <button @click.prevent="onClickSave">저장</button>
                            </li>
                        </ul>
                    </div>


                </div>
                <!-- layer 라는 카카오주소검색 박스 -->
                <div id="layer">
                </div>
            </div>
        </div>
    </div>
</div> 

<!-- 스크립트 -->
<script>
    new Vue({
        data: { // 메서드 방식은 리턴이 필요

            isModalShow:false,
            아이디:'',
            비밀번호:'',
            비밀번호확인:'',
            이름:'',
            이메일:'',
            휴대폰:'',
            주소1:'',
            주소2:'',
            성별:'선택안함',
            생년:'',
            생월:'',
            생일:'',
            추가입력사항:'',
            이용약관전체: [
                    "이용약관 동의(필수)",
                    "개인정보 수집∙이용 동의(필수)",
                    "개인정보 수집∙이용 동의(선택)",
                    "무료배송, 할인쿠폰 등 혜택/정보 수신 동의(선택)",
                    "이메일",
                    "SNS",
                    "본인은 만 14세 이상입니다.(필수)"
                ], //이용약관의 전체목록 = 이용약관전체
            이용약관동의: [],
        },
        methods: { // 메서드 방식은 리턴이 필요
            //마켓컬리 회원가입 폼전송 버튼 클릭 메서드
            submitMethod(){ //axios는 폼 데이터 형식을 만들어줘야한다.
                const data= new FormData(); // 파스칼케이스 사용할 것.
                data.append('userId',this.아이디)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userPw',this.비밀번호)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userName',this.이름)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userAddr1',this.주소1)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userAddr1',this.주소2)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userEmail',this.이메일)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userHp',this.휴대폰)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userGender',this.성별)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userBirth',`${this.생년}-${this.생월}-${this.생일}`)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userChooga',this.추가입력사항)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                data.append('userService',this.이용약관동의)//요기는 전송할 때 백엔드에 전송 될 아이디 , 저장된 데이터를 전송
                //axios API
                axios({
                    url: 'http://hyedal95.dothome.co.kr/vue_form_php/kurly_signup.php', // 웹서버 => mysql DB
                    method:'POST', // 폼데이터 보낼 때는 POST 방식
                    data: data 
                })
                .then((res)=>{
                    console.log("axios 전송 성공");
                    console.log(res.data);

                })
                .catch((err)=>{
                    console.log("axios 전송 실패");
                    console.log(err);
                })
            },

            //주소검색 열기 =모달열기
            addrSearchMethod: function(){
                this.isModalShow=true;
                //모달창 뜨면서
                //카카오 주소검색 api 떠야함.
                // 우편번호 찾기 화면을 넣을 element
                var element_layer = document.getElementById('layer');

                function closeDaumPostcode() {
                    // iframe을 넣은 element를 안보이게 한다.
                    element_layer.style.display = 'none';
                }

                
                    new daum.Postcode({
                        oncomplete: (data) => {
                            var addr = ''; // 주소 변수
                            var extraAddr = ''; // 참고항목 변수

                            if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                                addr = data.roadAddress;
                            } else { // 사용자가 지번 주소를 선택했을 경우(J)
                                addr = data.jibunAddress;
                            }

                            if(data.userSelectedType === 'R'){
                                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                                    extraAddr += data.bname;
                                }
                                if(data.buildingName !== '' && data.apartment === 'Y'){
                                    extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                                }
                                if(extraAddr !== ''){
                                    extraAddr = ' (' + extraAddr + ')';
                                }
                            }
                            
                            //검색이 완료되면 자동 저장된다.
                            this.주소1 =  `${data.zonecode} ) ${addr}  ${extraAddr}` //주소1에 세부주소까지 같이 들어감.
                            document.getElementById("addr2").focus();
                            element_layer.style.display = 'none';
                        },
                        width : '100%',
                        height : '100%',
                        maxSuggestItems : 5
                    }).embed(element_layer); //element_layer에 포함시켜라!

                    // iframe을 넣은 element를 보이게 한다.
                    element_layer.style.display = 'block';


                //스타일 지정하기


            },
            // 모달닫기
            onClickModalClose(){
                this.isModalShow=false;
            },
            onClickSave(){
                this.isModalShow=false; // 이때 메모리에 최종 저장하면 된다.
                // 주소1, 주소2 브라우저 저장소에 저장하기
                console.log(this.주소1);
                console.log(this.주소2);

                const addr ={
                    주소1 :this.주소1,
                    주소2 :this.주소2
                }
                // 로컬스토레이지에 저장=> 값은 문자열로 변환저장 JSON.stringify(객체) => 객체가 변환되서 저장이 된다.  (지우지 않는한 계속 저장)
                // 영구 저장
                // localStorage.setItem('키',값)
                // localStorage.setItem('배송지',addr) // 이렇게 저장하면 addr이 오브젝트로 뜬다. 그렇기에 json 으로 바꿔줘야함.
                localStorage.setItem('배송지',JSON.stringify(addr)) 
                // 섹션스토레이지는 브라우저 닫으면 삭제된다.
                sessionStorage.setItem('배송지',JSON.stringify(addr)) 
            },
            inputCheckAll(e){ //전체동의 체크이벤트 구현
                if(e.target.checked===true){
                    this.이용약관동의 = this.이용약관전체
                }else{
                    this.이용약관동의 = []; //배열은 각괄호로 비워주면된다.
                }
            }

        
        },
        created(){
            //세션 스토레이지 배송지 데이터 가져오기 문자열 => JSON.parse()객체형식으로 변환
            // console.log(sessionStorage.getItem('배송지'));
            
                const 배송지 = JSON.parse(sessionStorage.getItem('배송지'))  // .parse 는 원래 데이터로 변환해주는 것.
                this.주소1 = 배송지.주소1;
                this.주소2 = 배송지.주소2;
                // json데이터는 분류할 수 있음.
                
                console.log(배송지.주소1);
                console.log(배송지.주소2);
            
            
            

            
        }
    }).$mount('#wrap');
    
</script>


</body>
</html>